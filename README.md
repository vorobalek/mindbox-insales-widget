# Mindbox Widget для inSales

Виджет отправляет события магазина в Mindbox:

1. Просмотр категории.
2. Просмотр товара.
3. Изменение корзины.
4. Изменение избранного.

## Где взять архив виджета

Используйте релизный архив из этого репозитория на GitHub:

1. Откройте вкладку `Releases` в репозитории.
2. Выберите последний релиз (или нужную версию по тегу `vX.Y.Z`).
3. В блоке `Assets` скачайте нужный файл:
   - `mindbox-widget-vX.Y.Z.zip` (обычный)
   - `mindbox-widget-vX.Y.Z-min.zip` (минифицированный)

Если у вас нет доступа к репозиторию, запросите этот же архив у команды, которая поддерживает интеграцию.

## Установка виджета в inSales

1. В Админ-панели перейдите в `Настройки`.
2. В секции `Настройки сайта` выберите `Виджеты`.
3. Нажмите `Импортировать`.
4. На форме импорта добавьте архив из раздела `Где взять архив виджета` (обычный или минифицированный), выберите нужный актуальный шаблон и нажмите `Импортировать`.
5. Пролистайте страницу вниз и нажмите `Сохранить и закрыть`.
6. Нажмите `Ваш сайт`.
7. Нажмите `Редактор сайта`.
8. Добавьте в шапку новый виджет.
9. В меню добавления виджетов выберите раздел `Шапки`.
10. В списке выберите `Mindbox`.

## Настройка виджета

Поля настраиваются в карточке виджета в редакторе сайта.

| Название в inSales             | Обязательное | По умолчанию                  | Описание                                                        |
| ------------------------------ | ------------ | ----------------------------- | --------------------------------------------------------------- |
| `Домен API`                    | Да           | `api.mindbox.ru`              | Домен API Mindbox без `https://`.                               |
| `Точка интеграции`             | Нет          | Нет                           | Системное имя `Точки интеграции` в Mindbox.                     |
| `Внешняя система`              | Да           | `website`                     | Системное имя `Внешней системы` продуктов и заказов в Mindbox.  |
| `Включить интеграцию Web-Push` | Нет          | `false`                       | Включает вызов `mindbox("webpush.create")`.                     |
| `ServiceWorkerPath`            | Нет          | `/mindbox-services-worker.js` | Тестовый параметр `serviceWorkerPath` для `mindbox('create')`.  |
| `ServiceWorkerScope`           | Нет          | `/`                           | Тестовый параметр `serviceWorkerScope` для `mindbox('create')`. |
| `Просмотр категории`           | Нет          | `Website.ViewCategory`        | Системное имя `Операции` просмотра категории.                   |
| `Просмотр продукта`            | Нет          | `Website.ViewProduct`         | Системное имя `Операции` просмотра продукта.                    |
| `Установка корзины`            | Нет          | `Website.SetCart`             | Системное имя `Операции` установки корзины.                     |
| `Очистка корзины`              | Нет          | `Website.ClearCart`           | Системное имя `Операции` очистки корзины.                       |
| `Установка Избранного`         | Нет          | `Website.SetWishList`         | Системное имя `Операции` установки избранного.                  |
| `Очистка Избранного`           | Нет          | `Website.ClearWishList`       | Системное имя `Операции` очистки избранного.                    |

Если поле операции просмотра или установки оставлено пустым, соответствующее событие не отправляется.

Если поле операции очистки (`Очистка корзины` или `Очистка Избранного`) оставлено пустым, виджет отправляет операцию установки с пустым списком (`Установка корзины` / `Установка Избранного`), если операция установки заполнена.

Для работы WebPush интеграции нужно разместить сервис-воркер по инструкции:
https://developers.mindbox.ru/page/webpush

Параметры `ServiceWorkerPath` и `ServiceWorkerScope` передаются в `mindbox('create')` только если заполнены.

## Проверка после установки

1. Откройте страницу категории и страницу товара, проверьте отправку событий просмотра.
2. Добавьте и удалите товар из корзины, проверьте операции установки и очистки корзины.
3. Добавьте и удалите товар из избранного, проверьте соответствующие операции.
4. Если что-то не отправляется, откройте `Console` в браузере и проверьте сообщения с префиксом `[mindbox]`.

## Поддерживаемые браузеры и ОС

Совместимость ориентирована на официальный регламент inSales:
https://www.insales.ru/collection/doc-reglamenty/product/perechen-brauzerov-i-operatsionnyh-sistem-podderzhivaemyh-insales

## Лицензия

См. [LICENSE.md](LICENSE.md).
